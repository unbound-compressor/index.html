<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unbound Compressor - Smart Image Resizer</title>
    <style>
        :root { --primary: #9b4dca; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .header { background: var(--primary); color: white; width: 100%; padding: 15px 0; text-align: center; font-size: 24px; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 500px; margin-top: 30px; text-align: center; }
        .upload-box { border: 2px dashed var(--primary); padding: 20px; border-radius: 10px; cursor: pointer; margin-bottom: 20px; transition: 0.3s; }
        .upload-box:hover { background: #f0e6f7; }
        input[type="file"] { display: none; }
        .controls { display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 20px; }
        input[type="number"] { width: 80px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
        select { padding: 10px; border-radius: 5px; border: 1px solid #ddd; }
        button { background: var(--primary); color: white; border: none; padding: 12px 25px; border-radius: 5px; font-size: 16px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.3s; }
        button:hover { background: #823db1; transform: translateY(-2px); }
        #preview { max-width: 100%; border-radius: 10px; margin-top: 20px; display: none; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .status { margin-top: 15px; color: #2ecc71; font-weight: bold; display: none; }
        .footer { margin-top: auto; padding: 20px; color: #666; font-size: 14px; }
    </style>
</head>
<body>

<div class="header">U Unbound Compressor</div>

<div class="container">
    <div class="upload-box" onclick="document.getElementById('fileInput').click()">
        <p id="fileName">फोटो चुनें या यहाँ खींचें</p>
        <input type="file" id="fileInput" accept="image/*">
    </div>

    <div class="controls">
        <label>टारगेट साइज:</label>
        <input type="number" id="targetSize" value="20" min="1">
        <select id="unit">
            <option value="kb">KB</option>
            <option value="mb">MB</option>
        </select>
    </div>

    <button onclick="compressImage()">Compress Photo</button>

    <div id="status" class="status"></div>
    <img id="preview">
    <button id="downloadBtn" style="display:none; margin-top:15px; background: #27ae60;">Download Compressed Image</button>
</div>

<div class="footer">Created by Shivam | Unbound Safar</div>

<script>
    const fileInput = document.getElementById('fileInput');
    const fileName = document.getElementById('fileName');
    const preview = document.getElementById('preview');
    const status = document.getElementById('status');
    const downloadBtn = document.getElementById('downloadBtn');
    let originalImage = null;

    fileInput.onchange = (e) => {
        const file = e.target.files[0];
        if (file) {
            fileName.innerText = file.name;
            const reader = new FileReader();
            reader.onload = (event) => {
                originalImage = new Image();
                originalImage.src = event.target.result;
                originalImage.onload = () => {
                    preview.src = originalImage.src;
                    preview.style.display = 'inline-block';
                }
            };
            reader.readAsDataURL(file);
        }
    };

    async function compressImage() {
        if (!originalImage) { alert("कृपया पहले फोटो चुनें!"); return; }

        const targetKB = document.getElementById('targetSize').value * (document.getElementById('unit').value === 'mb' ? 1024 : 1);
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');

        let width = originalImage.width;
        let height = originalImage.height;
        canvas.width = width;
        canvas.height = height;
        ctx.drawImage(originalImage, 0, 0, width, height);

        let quality = 0.9;
        let compressedBlob = null;
        
        status.innerText = "Processing...";
        status.style.display = 'block';

        // Iterative compression to hit the target size
        for (let i = 0; i < 10; i++) {
            compressedBlob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', quality));
            if (compressedBlob.size / 1024 <= targetKB || quality <= 0.1) break;
            quality -= 0.15; // Reduce quality if size is too big
        }

        const url = URL.createObjectURL(compressedBlob);
        preview.src = url;
        status.innerText = `Success! Size: ${(compressedBlob.size / 1024).toFixed(2)} KB`;
        
        downloadBtn.style.display = 'block';
        downloadBtn.onclick = () => {
            const link = document.createElement('a');
            link.href = url;
            link.download = `unbound_${fileName.innerText}`;
            link.click();
        };
    }
</script>

</body>
</html>
